# Чат для обмена сообщениями в реальном времени

FullStack SPA приложение для обмена текстовыми, голосовыми сообщениями и изображениями с другими пользователями в реальном времени.

#### Посмотреть приложение можно по [ссылке]()

**_Данные для входа:_**  
**Первый пользователь:**  
Email: `user1@mail.ru`  
Пароль: `user123`  
**Второй пользователь:**  
Email: `user2@mail.ru`  
Пароль: `user234`

## Используемый стек

### Frontend:

- React
- TypeScript
- React-Router-Dom
- Redux
- Axios
- Formik
- Socket.io-client
- Material UI
- Styled Components

### Backend:

- NodeJs
- Express
- PostgreSQL
- Sequelize
- Cloudinary
- Socket.io

## Описание работы приложения

### Авторизация и аутентификация:

1. При авторизации и аутентификации, введенные пользователем данные проходят двойную валидацию как на _frontend_ (`formik`), так и на _backend_(`express-validator`).
2. Для авторизации необходимо ввести свои данные по форме регистрации. После чего на указанную почту придет письмо с ссылкой для активации аккаунта.  
   **Только прошедший активацию пользователь может войти в чат.**
3. При аутентификации проверяется существование почты в БД и происходит сверка паролей (пароли пользователей в БД хешированные с помощью пакета `bcrypt`), далее отправляются два токена: _access_ и _refresh_.  
   Токены генерируются с помощью пакета `jsonwebtoken`
4. При отсутствии токенов или истечения их жизни у пользователя нет доступа к запросам.
5. Если истекло время жизни у _access_ токена, то автоматически отправляется запрос на его обновление. Для этого проверяется существование _refresh_ токена в БД. При наличии живого токена опять генерируются и отправляются пара: _access_ и _refresh_.

### Панель диалогов:

1. В настройках ![setting](/readme_files/setting.jpg) пользователя можно изменить свой аватар и выйти из чата.
2. При добавлении диалога ![add_dilaog](/readme_files/add_dialog.jpg) открывается модальное окно со всеми зарегестрированными пользователями. Для того, чтобы добавить к себе пользователя, необходимо сразу отправить ему сообщение.Часть первого сообщения будет отображаться у пользователя в списке диалогов.  
   У добавленного пользователя также появится диалог в реальном времени.
3. Для того, чтобы отыскать добавленный диалог, можно воспользоваться поиском.
4. При обновлении страницы выбирается последний открытый диалог. Если диалоги не вмещаются на одну страницу, то происходит автоматическая прокрутка (также прокручиваются все сообщения до последнего в окне чата).
5. Когда пользователь входит в чат, то у других появляется онлайн-индикатор ![online_indicate](/readme_files/online_indicate.jpg) в реальном времени.
6. Если диалог не выбран, то при получении сообщения в правой части появляется число в кружке ![amount](/readme_files/amount.jpg), означающее количество сообщений.

### Окно сообщений:

1. Удалить диалог можно через настройки ![dialog-settings](/readme_files/dialog-settings.jpg) в окне сообщений.
2. Когда пользователь входит в чат, то у других также появляется онлайн-индикатор в окне сообщений ![online_indicate_2](/readme_files/online-indicate_2.jpg) в реальном времени.
3. Отправлять можно текстовые сообщения вместе с emoji (используется пакет `emoji-picker-react`), голосовые сообщения и изображения.
4. Изображения отправляются несколько штук за один раз вместе с текстовым сообщением или отдельно.
5. Для записи голосового сообщения необходимо нажать на иконку ![voice-record](/readme_files/voice-record.jpg) и удерживать её. После отжатия мыши сообщение автоматически отправится.
6. При наборе текста сообщения у другого пользователя появляется пульсирующая индикация печати ![typing](/readme_files/typing.jpg), сообщающая, что ему скоро придет сообщение.

### Другие особенности:

1. В backend написаны больше методов, чем можем использовать на клиенте. Так как эти методы связаны с удалением и обновлением данных приложения.
2. Все изображения (также аватары) и голосовые сообщения хранятся в облачном хранилище `Cloudinary`
3. Архитектура приложения постоена таким образом, чтобы в дальнейшем легко можно было её масштабировать.
